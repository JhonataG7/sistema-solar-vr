<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Sistema Solar VR — Anéis + Estrelas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

  <style>
    body { margin: 0; background: #000; }
  </style>

  <script>
  /* ============================
       TEXTURAS GERADAS POR CANVAS
     ============================ */

  function createStarTexture(width=4096,height=2048,starCount=5000){
    const c=document.createElement('canvas');
    c.width=width; c.height=height;
    const ctx=c.getContext('2d');

    ctx.fillStyle="#000";
    ctx.fillRect(0,0,width,height);

    for(let i=0;i<starCount;i++){
      const x=Math.random()*width;
      const y=Math.random()*height;
      const r=Math.random()*1.8;
      ctx.fillStyle=`rgba(255,255,255,${0.5+Math.random()*0.5})`;
      ctx.beginPath();
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fill();
    }
    return c.toDataURL("image/jpeg",0.9);
  }

  function createSaturnRingTexture(size=2048){
    const c=document.createElement('canvas');
    c.width=size; c.height=size;
    const ctx=c.getContext('2d');

    const cx=size/2, cy=size/2;
    const outer=size*0.48;
    const inner=size*0.18;

    for(let i=0;i<200;i++){
      let t=i/199;
      let rInner=inner+(outer-inner)*t;
      let thick=(outer-inner)/200;
      let g=160+Math.random()*70;
      let alpha=0.25+Math.random()*0.12;

      ctx.beginPath();
      ctx.fillStyle=`rgba(${g},${g},${g},${alpha})`;
      ctx.arc(cx,cy,rInner+thick,0,Math.PI*2);
      ctx.arc(cx,cy,rInner,0,Math.PI*2,true);
      ctx.fill();
    }

    return c.toDataURL("image/png");
  }

  document.addEventListener("DOMContentLoaded",()=>{
    const assets=document.createElement("a-assets");

    const sky=document.createElement("img");
    sky.id="gen-sky";
    sky.src=createStarTexture();
    assets.appendChild(sky);

    const ring=document.createElement("img");
    ring.id="gen-ring";
    ring.src=createSaturnRingTexture();
    assets.appendChild(ring);

    document.body.appendChild(assets);
  });
  </script>
</head>

<body>

<a-scene background="color: black">

  <!-- Céu estelar -->
  <a-sky src="#gen-sky" rotation="0 -90 0"></a-sky>

  <!-- Texturas reais dos planetas -->
  <a-assets timeout="20000">
      <img id="tex-sun" src="./textures/2k_sun.jpg">
      <img id="tex-mercury" src="./textures/2k_mercury.jpg">
      <img id="tex-venus" src="./textures/2k_venus_surface.jpg">
      <img id="tex-earth" src="./textures/2k_earth_daymap.jpg">
      <img id="tex-mars" src="./textures/2k_mars.jpg">
      <img id="tex-jupiter" src="./textures/2k_jupiter.jpg">
      <img id="tex-saturn" src="./textures/2k_saturn.jpg">
      <img id="tex-uranus" src="./textures/2k_uranus.jpg">
      <img id="tex-neptune" src="./textures/2k_neptune.jpg">
  </a-assets>

  <!-- Câmera com movimento -->
  <a-entity camera 
            look-controls="pointerLockEnabled: true"
            wasd-controls="acceleration: 25"
            position="0 1.6 8">
      <a-cursor color="white"></a-cursor>
  </a-entity>

  <!-- Luz solar -->
  <a-entity light="type: point; intensity: 2" position="0 0 0"></a-entity>

  <!-- Painel de informações -->
  <a-entity id="infoPanel" visible="false">
      <a-plane width="3" height="1.8" color="#000" opacity="0.22"></a-plane>
      <a-plane width="3.1" height="1.9" color="#fff" opacity="0.05" position="0 0 -0.01"></a-plane>
      <a-text id="infoText" value="" align="center" width="2.7" color="#fff"></a-text>
  </a-entity>

  <!-- SOL (não tem classe planet!) -->
  <a-sphere src="#tex-sun" radius="1.7"
            emissive="#ffaa00"
            emissiveIntensity="1.25"
            class="star">
  </a-sphere>

  <!-- PLANETAS -->
  <a-sphere src="#tex-mercury" position="3 0 -5" radius="0.22"
            animation="property: rotation; to: 0 360 0; dur: 12000; loop: true"
            class="planet" data-name="Mercúrio"></a-sphere>

  <a-sphere src="#tex-venus" position="5 0 -7" radius="0.36"
            animation="property: rotation; to: 0 -360 0; dur: 18000; loop: true"
            class="planet" data-name="Vênus"></a-sphere>

  <a-sphere src="#tex-earth" position="7.5 0 -10" radius="0.40"
            animation="property: rotation; to: 0 360 0; dur: 16000; loop: true"
            class="planet" data-name="Terra"></a-sphere>

  <a-sphere src="#tex-mars" position="10 0 -12" radius="0.32"
            animation="property: rotation; to: 0 360 0; dur: 20000; loop: true"
            class="planet" data-name="Marte"></a-sphere>

  <a-sphere src="#tex-jupiter" position="15 0 -15" radius="0.95"
            animation="property: rotation; to: 0 360 0; dur: 30000; loop: true"
            class="planet" data-name="Júpiter"></a-sphere>

  <!-- SATURNO + ANÉIS -->
  <a-entity position="20 0 -17">
      <a-sphere id="saturn" src="#tex-saturn" radius="0.78"
                animation="property: rotation; to: 0 360 0; dur: 32000; loop: true"
                class="planet" data-name="Saturno"></a-sphere>

      <a-torus radius="1.35"
               radius-tubular="0.08"
               segments-radial="128"
               segments-tubular="64"
               rotation="90 0 0"
               material="src: #gen-ring; transparent: true; opacity: 1; side: double">
      </a-torus>
  </a-entity>

  <a-sphere src="#tex-uranus" position="25 0 -19" radius="0.62"
            animation="property: rotation; to: 0 360 0; dur: 35000; loop: true"
            class="planet" data-name="Urano"></a-sphere>

  <a-sphere src="#tex-neptune" position="30 0 -22" radius="0.58"
            animation="property: rotation; to: 0 360 0; dur: 38000; loop: true"
            class="planet" data-name="Netuno"></a-sphere>

  <!-- SCRIPT FINAL -->
  <script>
    const info = {
      "Mercúrio": ["Planeta mais próximo do Sol.","Rochoso e pequeno.","Temperaturas extremas."],
      "Vênus": ["Atmosfera muito densa.","Efeito estufa extremo.","Rotação invertida."],
      "Terra": ["Único com vida.","70% de água.","Campo magnético forte."],
      "Marte": ["Planeta vermelho.","Maior vulcão conhecido.","Possui água congelada."],
      "Júpiter": ["Maior planeta.","Grande Mancha Vermelha.","Campo magnético poderoso."],
      "Saturno": ["Famoso pelos anéis.","Baixa densidade.","Ventos intensos."],
      "Urano": ["Inclinação de 98°.","Cor azul-esverdeada.","Muito frio."],
      "Netuno": ["Ventos mais rápidos.","Muito distante.","Cor azul intensa."]
    };

    function format(n){
      return `${n}\n• ${info[n].join("\n• ")}`;
    }

    const panel=document.querySelector("#infoPanel");
    const text=document.querySelector("#infoText");
    const cam=document.querySelector("[camera]");
    const planets=document.querySelectorAll(".planet");

    planets.forEach(p => {
      p.addEventListener("mouseenter", () => {
        const name = p.getAttribute("data-name");

        // Garante que apenas planetas válidos exibem tooltip
        if (!name || !info[name]) return;

        text.setAttribute("value", format(name));
        panel.setAttribute("visible", true);

        panel.object3D.position.copy(p.object3D.position);
        panel.object3D.position.y += 2.3;
        panel.object3D.lookAt(cam.object3D.position);
      });

      p.addEventListener("mouseleave", () => {
        panel.setAttribute("visible", false);
      });
    });
  </script>

</a-scene>

</body>
</html>
